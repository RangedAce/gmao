<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Modifier le matériel</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 6px; margin-top: 4px; }
    button { margin-top: 15px; padding: 8px 12px; }
  </style>
</head>
<body>

<h1>Modifier le matériel</h1>

<form method="post">

  <label for="id_client">Client</label>
  <select name="id_client" id="id_client" required>
    {% for c in clients %}
      <option value="{{ c.id }}" {% if c.id == m.id_client %}selected{% endif %}>{{ c.nom }}</option>
    {% endfor %}
  </select>

  <label for="category_id">Catégorie</label>
  <select name="category_id" id="category_id" required>
    <option value="">-- Choisir --</option>
    {% for cat in categories %}
      <option value="{{ cat.id }}" {% if cat.id == m.category_id %}selected{% endif %}>{{ cat.name }}</option>
    {% endfor %}
  </select>

  <label for="type_id">Type</label>
  <select name="type_id" id="type_id" required>
    <option value="">-- Choisir --</option>
    {% for t in types %}
      <option value="{{ t.id }}" data-cat="{{ t.category_id }}" {% if t.id == m.type_id %}selected{% endif %}>{{ t.name }}</option>
    {% endfor %}
  </select>

  <label>Modèle</label>
  <input type="text" name="modele" value="{{ m.modele }}" required>

  <label>Numéro de série</label>
  <input type="text" name="numero_serie" value="{{ m.numero_serie }}" required>

  <label>Date d'installation</label>
  <input type="date" name="date_installation" value="{{ m.date_installation }}">

  <label>Fin de garantie</label>
  <input type="date" name="garantie_fin" value="{{ m.garantie_fin }}">

  <label>Statut</label>
  <select name="statut">
    <option value="en service" {% if m.statut == "en service" %}selected{% endif %}>En service</option>
    <option value="hs" {% if m.statut == "hs" %}selected{% endif %}>HS</option>
    <option value="retire" {% if m.statut == "retire" %}selected{% endif %}>Retiré</option>
  </select>

  <button type="submit">Enregistrer</button>
</form>

<p><a href="/materiels/{{ m.id }}">← Retour</a></p>

<script>
  const categorySelect = document.getElementById("category_id");
  const typeSelect = document.getElementById("type_id");

  function filterTypes() {
    const cat = categorySelect.value;
    const options = typeSelect.querySelectorAll("option");
    options.forEach(opt => {
      if (!opt.dataset.cat) return;
      if (!cat || opt.dataset.cat === cat) {
        opt.style.display = "block";
      } else {
        opt.style.display = "none";
        if (opt.selected) opt.selected = false;
      }
    });
  }

  categorySelect.addEventListener("change", filterTypes);
  filterTypes();
</script>

</body>
</html>
