{% extends "base.html" %}

{% block title %}GMAO - Accueil{% endblock %}

{% block content %}
<div class="grid-3">
  <div class="card">
    <h2>Tickets non traités &gt; 24h</h2>
    <p style="font-size:32px; margin:4px 0;">{{ tickets_unhandled }}</p>
    <p class="muted">Sans commentaire ni changement de statut sur les 24 dernières heures.</p>
  </div>

  <div class="card">
    <h2>Tickets par état</h2>
    {% set max_state = state_counts.values()|max if state_counts else 0 %}
    {% if state_counts %}
      <div class="bar-list">
        {% for state, count in state_counts.items() %}
          <div class="bar-row">
            <div class="bar-label">{{ state }}</div>
            <div class="bar-track">
              {% set width = 0 if max_state == 0 else (count / max_state * 100) %}
              <div class="bar-fill" style="width: {{ '%.0f'|format(width) }}%;"></div>
            </div>
            <div class="bar-value">{{ count }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">Pas de tickets.</p>
    {% endif %}
  </div>

  <div class="card">
    <h2>Tickets par assigné</h2>
    {% set max_assigned = assigned_counts.values()|max if assigned_counts else 0 %}
    {% if assigned_counts %}
      <div class="bar-list">
        {% for user_label, count in assigned_counts.items() %}
          <div class="bar-row">
            <div class="bar-label">{{ user_label }}</div>
            <div class="bar-track">
              {% set width = 0 if max_assigned == 0 else (count / max_assigned * 100) %}
              <div class="bar-fill" style="width: {{ '%.0f'|format(width) }}%;"></div>
            </div>
            <div class="bar-value">{{ count }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">Pas d'assignations.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
