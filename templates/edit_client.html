<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Modifier le client</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<nav>
  <a href="/">Accueil</a>
  <a href="/tickets">Tickets</a>
  <a href="/materiels">Materiel</a>
  <a href="/clients">Clients</a>
  <a href="/planning">Planning</a>
  <span class="right">
    {% if current_user %}
      <a href="/me/password">Mon profil</a>
      {% if is_admin %} | <a href="/users">Gerer utilisateurs & groupes</a>{% endif %}
      | {{ current_user.full_name }} ({{ current_user.role }}) - <a href="/logout">Deconnexion</a>
    {% else %}
      <a href="/login">Connexion</a>
    {% endif %}
  </span>
</nav>

<main>
  <div class="card">
    <h1>Modifier le client</h1>
    <p><strong>Code client :</strong> CLT-{{ "%04d"|format(client.id) }}</p>
    <p><a class="btn secondary" href="/clients/{{ client.id }}/sites/nouveau">Ajouter un site</a></p>

    {% if client.sites %}
      <h3>Sites existants</h3>
      <table class="mt-1">
        <tr>
          <th>Nom</th>
          <th>Adresse</th>
          <th>Ville</th>
        </tr>
        {% for s in client.sites %}
          <tr>
            <td>{{ s.nom }}</td>
            <td>{{ s.adresse }}</td>
            <td>{{ s.ville }}</td>
          </tr>
        {% endfor %}
      </table>
    {% endif %}

    <form method="post" class="mt-2">
      <label for="nom">Nom du client</label>
      <input type="text" id="nom" name="nom" value="{{ client.nom }}" required>

      <label for="contract_type">Contrat</label>
      <select name="contract_type" id="contract_type">
        <option value="none" {% if client.contract_type == "none" %}selected{% endif %}>Pas de contrat</option>
        <option value="credit_time" {% if client.contract_type == "credit_time" %}selected{% endif %}>Credit temps (heures)</option>
        <option value="credit_point" {% if client.contract_type == "credit_point" %}selected{% endif %}>Credit points (interventions)</option>
      </select>

      <label for="contract_balance">Valeur (heures ou points)</label>
      <input type="number" step="0.01" min="0" name="contract_balance" id="contract_balance" value="{{ client.contract_balance }}">

      <button type="submit" class="mt-2">Enregistrer</button>
    </form>

    {% if error %}
      <p style="color:#ff8a8a;" class="mt-1">{{ error }}</p>
    {% endif %}

    <p class="mt-2"><a href="/">Retour a la liste des clients</a></p>
  </div>
</main>

</body>
</html>

